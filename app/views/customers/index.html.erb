<p id="notice"><%= notice %></p>

<h1>Customers</h1>

<table border="1", bgcolor="#faebd7" >
  <thead>
    <tr>
      <th>Name</th>
      <th>Telephone</th>
      <th>City</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @customers.each do |customer| %>
      <tr>
        <td><%= customer.name %></td>
        <td><%= customer.telephone %></td>
        <td><%= customer.city %></td>
        <td><%= link_to 'Show', customer %></td>
        <td><%= link_to 'Edit', edit_customer_path(customer) %></td>
        <td><%= link_to 'Destroy', customer, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>

      <% if customer.invoices.count>0 %>
      <tr>
        <td></td>
        <td colspan="5">

          <table bgcolor="aqua">
            <thead>
            <tr>
              <th>Data</th>
              <th>No</th>
              <th colspan="3"></th>
            </tr>
            </thead>

            <tbody>
            <% customer.invoices.each do |invoice| %>
              <tr>
                <td><%= invoice.data %></td>
                <td><%= invoice.id %></td>
                <td><%= link_to 'Show', invoice %></td>
                <td><%= link_to 'Edit', edit_invoice_path(invoice) %></td>
                <td><%= link_to 'Destroy', invoice, method: :delete, data: { confirm: 'Are you sure?' } %></td>
              </tr>
              <% if invoice.invoice_items.count > 0 %>
                <tr>
                  <td></td>
                  <td colspan="4">

                    <table border="1">
                      <thead>
                      <tr>
                        <th>Item</th>
                        <th>Number</th>
                        <th>Value</th>

                      </tr>
                      </thead>

                      <tbody>
                      <% @suma=0 %>
                      <% invoice.invoice_items.each do |invoice_item| %>
                        <tr>
                          <td><%= invoice_item.item.name %></td>
                          <td><%= invoice_item.number %></td>
                          <td><%= invoice_item.number*invoice_item.item.price %></td>
                        </tr>
                        <% @suma=@suma+invoice_item.number*invoice_item.item.price %>
                      <% end %>
                      <tr>
                        <td colspan="3" align="right"> Razem: <%=@suma %> </td>
                      </tr>
                      </tbody>
                    </table>
                  </td>
                </tr>
              <% end %>

            <% end %>
            </tbody>
          </table>


        </td>

      </tr>
    <% end %>

    <% end %>
  </tbody>
</table>

<br>

<%= link_to 'New Customer', new_customer_path %>
